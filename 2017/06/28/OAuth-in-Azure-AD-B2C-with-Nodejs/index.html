<!DOCTYPE html>
<html lang=en>
<head>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85N4CJ');</script>
<!-- End Google Tag Manager -->

	
    <meta charset="utf-8">
    
    <title>OAuth in Azure AD B2C with Nodejs | feng.blog();</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Recently we need to build a Nodejs single-page-application (SPA) solution that is using Azure AD B2C as the identity provider (idp). Since it is a single-page-application, we are going to use OAuth2 I">
<meta property="og:type" content="article">
<meta property="og:title" content="OAuth in Azure AD B2C with Nodejs">
<meta property="og:url" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/index.html">
<meta property="og:site_name" content="feng.blog();">
<meta property="og:description" content="Recently we need to build a Nodejs single-page-application (SPA) solution that is using Azure AD B2C as the identity provider (idp). Since it is a single-page-application, we are going to use OAuth2 I">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/what-is-oauth.jpg">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Azure%20AD%20B2C%20Create%20Tenant.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Switch%20domain.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Connect%20Azure%20AD%20B2C%20to%20subscription.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/AAD%20B2C%20Dashboard.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Create%20Linkedin%20App.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Add%20linkedin%20as%20an%20Identity%20provider.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Select%20sign-up%20attributes.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Select%20application%20claims.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Register%20Web%20Api.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Published%20scopes.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Run%20webapi%20on%20localhost.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Unauthorized%20access%20to%20the%20api.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Register%20client%20app.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Grant%20client%20app%20API%20access.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/login%20with%20linkedin.gif">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Claim%20properties.png">
<meta property="og:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/All%20users%20in%20AAD%20B2C.png">
<meta property="article:published_time" content="2017-06-28T12:54:24.000Z">
<meta property="article:modified_time" content="2025-03-28T09:05:16.881Z">
<meta property="article:author" content="Feng Lu">
<meta property="article:tag" content="Azure">
<meta property="article:tag" content="OAuth">
<meta property="article:tag" content="OpenID">
<meta property="article:tag" content="Azure AD B2C">
<meta property="article:tag" content="Nodejs">
<meta property="article:tag" content="Authentication">
<meta property="article:tag" content="Authorization">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/what-is-oauth.jpg">
    

    
        <link rel="alternate" href="/atom.xml" title="feng.blog();" type="application/atom+xml" />
    

    
        <link rel="icon" href="/images/favicon.png" />
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">


    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85N4CJ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">feng.blog();</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/images/avatar.jpg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/images/avatar.jpg" />
            <h2 id="name">Feng Lu</h2>
            <h3 id="title">Builder, Speaker, Architect and Technical Evangelist</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Oslo Area, Norway</span>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                39
                <span>posts</span>
            </div>
            <div class="article-info-block">
                129
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://www.linkedin.com/in/linkcd" target="_blank" title="linkedin" class=tooltip>
                            <i class="fa fa-linkedin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://github.com/linkcd" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/atom.xml" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-OAuth-in-Azure-AD-B2C-with-Nodejs" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            OAuth in Azure AD B2C with Nodejs
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/">
            <time datetime="2017-06-28T12:54:24.000Z" itemprop="datePublished">2017-06-28</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/Authentication/" rel="tag">Authentication</a>, <a class="tag-link-link" href="/tags/Authorization/" rel="tag">Authorization</a>, <a class="tag-link-link" href="/tags/Azure/" rel="tag">Azure</a>, <a class="tag-link-link" href="/tags/Azure-AD-B2C/" rel="tag">Azure AD B2C</a>, <a class="tag-link-link" href="/tags/Nodejs/" rel="tag">Nodejs</a>, <a class="tag-link-link" href="/tags/OAuth/" rel="tag">OAuth</a>, <a class="tag-link-link" href="/tags/OpenID/" rel="tag">OpenID</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>Recently we need to build a Nodejs single-page-application (SPA) solution that is using Azure AD B2C as the identity provider (idp). Since it is a single-page-application, we are going to use OAuth2 Implicit Flow.</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/what-is-oauth.jpg" class="" title="picture credit:stormpath.com">

<p>This article demonstrates the basic steps for setting up both the server side (WebAPI)  as well as the client application.</p>
<span id="more"></span>

<h1 id="Setup-your-own-Azure-AD-B2C"><a href="#Setup-your-own-Azure-AD-B2C" class="headerlink" title="Setup your own Azure AD B2C"></a>Setup your own Azure AD B2C</h1><h2 id="Create-an-Azure-AD-B2C-tenant"><a href="#Create-an-Azure-AD-B2C-tenant" class="headerlink" title="Create an Azure AD B2C tenant"></a>Create an Azure AD B2C tenant</h2><p>First of all, let’s create an AAD B2C tenant with domain <strong>luconsultingb2c.onmicrosoft.com</strong> by following the steps in <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-get-started">this document</a>.</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Azure%20AD%20B2C%20Create%20Tenant.png" class="" title="Azure AD B2C Create Tenant">

<p>Then you can switch by using the top-right menu</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Switch%20domain.png" class="" title="Switch domain">

<p>If you want, you can connect the AAD to an existing Azure subscription</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Connect%20Azure%20AD%20B2C%20to%20subscription.png" class="" title="Connect Azure AD B2C to subscription">

<p>Now you can start using this tenant</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/AAD%20B2C%20Dashboard.png" class="" title="AAD B2C Dashboard">


<h2 id="Configure-Linkedin-as-an-identity-provider"><a href="#Configure-Linkedin-as-an-identity-provider" class="headerlink" title="Configure Linkedin as an identity provider"></a>Configure Linkedin as an identity provider</h2><p>Follow the step in <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-setup-li-app" title="https:&#x2F;&#x2F;docs.microsoft.com&#x2F;en-us&#x2F;azure&#x2F;active-directory-b2c&#x2F;active-directory-b2c-setup-li-app">Azure Active Directory B2C: Provide sign-up and sign-in to consumers with LinkedIn accounts</a>. </p>
<ol>
<li>Create a Linkedin App to generate the client id and secret</li>
</ol>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Create%20Linkedin%20App.png" class="" title="Create a Linkedin App">

<ol start="2">
<li>Add Linkedin as an identity provider in AAD B2C, together with Email as local accounts</li>
</ol>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Add%20linkedin%20as%20an%20Identity%20provider.png" class="" title="Add linkedin as an Identity provider">
<p>Remember to give it a meaningful name for your Linkedin idp, as the name will be used in the login page. (Do not use “LI” as the Microsoft article suggested)</p>
<h2 id="Create-policy"><a href="#Create-policy" class="headerlink" title="Create policy"></a>Create policy</h2><ol>
<li>Now create a Signup&#x2F;Signin prolicy by following the steps in <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-policies">Azure Active Directory B2C: Built-in policies</a>.<br> We name this policy <strong>“SiUpIn”</strong>, and it will be automatically renamed <strong>“B2C_1_SiUpIn”</strong> (the B2C_1_ fragment is automatically added)</li>
<li>When user sign up, I would like to ask for <strong>Given Name</strong>, <strong>Surname Name</strong>, <strong>Email Address</strong>, <strong>Display Name</strong>, <strong>Job Title</strong> and <strong>Country&#x2F;Region</strong>  <img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Select%20sign-up%20attributes.png" class="" title="Select sign-up attributes"></li>
<li>After sign in, I would like to have <strong>Display Name</strong>, <strong>Country&#x2F;Region</strong> and <strong>Job Title</strong> to be included in the claim. In addition, I want to know the <strong>idp</strong> and if <strong>newUser</strong> is true, so select them. <img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Select%20application%20claims.png" class="" title="Select application claims"></li>
<li>Done </li>
</ol>
<h1 id="Create-and-register-your-WebAPI"><a href="#Create-and-register-your-WebAPI" class="headerlink" title="Create and register your WebAPI"></a>Create and register your WebAPI</h1><h2 id="Register-your-WebAPI"><a href="#Register-your-WebAPI" class="headerlink" title="Register your WebAPI"></a>Register your WebAPI</h2><p>Follow the steps in <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-app-registration">Azure Active Directory B2C: Register your application</a> to register a web api named <strong>B2CEchoWebAPI</strong></p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Register%20Web%20Api.png" class="" title="Register Web API">
<p>Note:</p>
<ul>
<li>Enable the <strong>Web App&#x2F;Web API</strong> setting for the web api.</li>
<li><strong>Reply URL</strong> to <strong><a target="_blank" rel="noopener" href="http://localhost:5000/">http://localhost:5000/</a></strong> as we will run the web api there.</li>
<li>HTTP protocol is allowed as far as it is for localhost. If it is external, we have to use HTTPS. </li>
<li>Even the <strong>App ID URI</strong> is marked as optional, this is needed to construct the scopes that are configured in you single page application’s code</li>
</ul>
<h2 id="Setup-policy"><a href="#Setup-policy" class="headerlink" title="Setup policy"></a>Setup policy</h2><p>Once Web API is registered, open the app’s <strong>Published Scopes</strong> blade and add any extra scopes you want.</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Published%20scopes.png" class="" title="Published scopes">
<p>Note:</p>
<ul>
<li>The scope is used for controlling permissions: an access token defines the permissions that are granted to the bearer of the token. The permissions are defined by you (the API owner) and you control what happens when your API receives a token with that permission. </li>
<li>In this case, I define 3 permission levels: <strong>“read”</strong>, <strong>“write”</strong> and <strong>“performXYZ”</strong>.</li>
<li>When the API receives a token that has the “read” value in the scope, the API will do actions that I think are okay for a user that has a “read” permission.</li>
<li>Microsoft document mentioned that there is a default scope <strong>“user_impersonation”</strong>, but it is not mandatory. AAD B2C doesn’t care what the permission values are. It simply ensures that scopes that are requested are valid and then generates a proper token when they are valid. It is up to you what you want your API to do when it receives an access token with a permission called “user_impersonation”. The “user_impersonation” scope is there by default because there needs to be at least one scope defined when a user requests a token, and you can use the “user_impersonation” to be that scope.</li>
<li>By default, applications are granted the ability to access the user’s profile via the <strong>“openid”</strong> permission, and generate refresh tokens via the <strong>“offline_access”</strong> permission. But you do NOT need to specify them here.</li>
</ul>
<p>Write down the <strong>AppID URI</strong> and <strong>Published Scopes values</strong>, You will need them in your client application code. The format for calling will be “https:&#x2F;&#x2F;{tenent}&#x2F;{AppID URI}&#x2F;{scope value}”, for example “<a target="_blank" rel="noopener" href="https://luconsultingb2c.onmicrosoft.com/B2CEchoWebAPI/performXYZ">https://luconsultingb2c.onmicrosoft.com/B2CEchoWebAPI/performXYZ</a>“.</p>
<h2 id="Create-a-Nodejs-based-web-api"><a href="#Create-a-Nodejs-based-web-api" class="headerlink" title="Create a Nodejs based web api"></a>Create a Nodejs based web api</h2><p>In this case, I am using a forked version of <a target="_blank" rel="noopener" href="https://github.com/Azure-Samples/active-directory-b2c-javascript-nodejs-webapi">Microsoft sample code</a>, with small modification. You can access it at <a target="_blank" rel="noopener" href="https://github.com/linkcd/active-directory-b2c-javascript-nodejs-webapi">https://github.com/linkcd/active-directory-b2c-javascript-nodejs-webapi</a>.</p>
<h3 id="Packages"><a href="#Packages" class="headerlink" title="Packages"></a>Packages</h3><p>It is using the common <a target="_blank" rel="noopener" href="http://passportjs.org/">passport</a> and <a target="_blank" rel="noopener" href="https://github.com/AzureAD/passport-azure-ad">passport-azure-ad</a> for AAD strategies.</p>
<h3 id="Code-for-authentication"><a href="#Code-for-authentication" class="headerlink" title="Code for authentication"></a>Code for authentication</h3><p>(full code is at <a target="_blank" rel="noopener" href="https://github.com/linkcd/active-directory-b2c-javascript-nodejs-webapi/blob/master/index.js">https://github.com/linkcd/active-directory-b2c-javascript-nodejs-webapi/blob/master/index.js</a>)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">&quot;passport&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">BearerStrategy</span> = <span class="built_in">require</span>(<span class="string">&#x27;passport-azure-ad&#x27;</span>).<span class="property">BearerStrategy</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//our tenent</span></span><br><span class="line"><span class="keyword">var</span> tenantID = <span class="string">&quot;luconsultingb2c.onmicrosoft.com&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">//client id of registered web api: &quot;B2CEchoWebAPI&quot;</span></span><br><span class="line"><span class="keyword">var</span> clientID = <span class="string">&quot;f40734c1-5990-47fc-91b5-deceebac0089&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">//our defined policy, include Linkedin </span></span><br><span class="line"><span class="keyword">var</span> policyName = <span class="string">&quot;B2C_1_SiUpIn&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    <span class="attr">identityMetadata</span>: <span class="string">&quot;https://login.microsoftonline.com/&quot;</span> + tenantID + <span class="string">&quot;/v2.0/.well-known/openid-configuration/&quot;</span>,</span><br><span class="line">    <span class="attr">clientID</span>: clientID,</span><br><span class="line">    <span class="attr">policyName</span>: policyName,</span><br><span class="line">    <span class="attr">isB2C</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">validateIssuer</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">loggingLevel</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">    <span class="attr">passReqToCallback</span>: <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bearerStrategy = <span class="keyword">new</span> <span class="title class_">BearerStrategy</span>(options,</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">token, done</span>) &#123;</span><br><span class="line">        <span class="comment">// Send user info using the second argument</span></span><br><span class="line">        <span class="title function_">done</span>(<span class="literal">null</span>, &#123;&#125;, token);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(passport.<span class="title function_">initialize</span>());</span><br><span class="line">passport.<span class="title function_">use</span>(bearerStrategy);</span><br></pre></td></tr></table></figure>

<p>Then define API endpoint</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">    res.<span class="title function_">header</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Authorization, Origin, X-Requested-With, Content-Type, Accept&quot;</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/hello&quot;</span>,</span><br><span class="line">    passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;oauth-bearer&#x27;</span>, &#123;<span class="attr">session</span>: <span class="literal">false</span>&#125;),</span><br><span class="line">    <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> claims = req.<span class="property">authInfo</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;User info: &#x27;</span>, req.<span class="property">user</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Validated claims: &#x27;</span>, claims);</span><br><span class="line">        </span><br><span class="line">	<span class="comment">//do this ONLY if the required scope include &quot;read&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (claims[<span class="string">&#x27;scp&#x27;</span>].<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>).<span class="title function_">indexOf</span>(<span class="string">&quot;read&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Service relies on the name claim.  </span></span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;<span class="string">&#x27;name&#x27;</span>: claims[<span class="string">&#x27;name&#x27;</span>]&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Invalid Scope, 403&quot;</span>);</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;insufficient_scope&#x27;</span>&#125;); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Now run it at local</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Run%20webapi%20on%20localhost.png" class="" title="Run webapi on localhost">

<p>And confirm that the endpoint is protected</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Unauthorized%20access%20to%20the%20api.png" class="" title="Unauthorized access to the api">

<p>Now the Web API part is done, let’s move to the client part.</p>
<h1 id="Create-and-register-your-client-app"><a href="#Create-and-register-your-client-app" class="headerlink" title="Create and register your client app"></a>Create and register your client app</h1><h2 id="Register-your-client-app"><a href="#Register-your-client-app" class="headerlink" title="Register your client app"></a>Register your client app</h2><p>Follow the steps in <a target="_blank" rel="noopener" href="https://docs.microsoft.com/azure/active-directory-b2c/active-directory-b2c-app-registration#register-a-web-application">register your single page application in your B2C tenant</a>, so that your client has its own Application&#x2F;client ID. </p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Register%20client%20app.png" class="" title="Register client app">
<p>Note:</p>
<ul>
<li>Enable the <strong>Web App&#x2F;Web API</strong> setting for the web api.</li>
<li><strong>Reply URL</strong> to <strong><a target="_blank" rel="noopener" href="http://localhost:6420/">http://localhost:6420/</a></strong> as we will run the client app there.</li>
<li>HTTP protocol is allowed as far as it is for localhost. If it is external, we have to use HTTPS.</li>
</ul>
<h2 id="Grant-the-client-app-access-to-the-web-API"><a href="#Grant-the-client-app-access-to-the-web-API" class="headerlink" title="Grant the client app access to the web API"></a>Grant the client app access to the web API</h2><img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Grant%20client%20app%20API%20access.png" class="" title="Grant client app API access">

<h2 id="Create-the-client-app"><a href="#Create-the-client-app" class="headerlink" title="Create the client app"></a>Create the client app</h2><p>Again, I am using a forked version of <a target="_blank" rel="noopener" href="https://github.com/Azure-Samples/active-directory-b2c-javascript-msal-singlepageapp">Microsoft sample code</a>, you can find it at <a target="_blank" rel="noopener" href="https://github.com/linkcd/active-directory-b2c-javascript-msal-singlepageapp">https://github.com/linkcd/active-directory-b2c-javascript-msal-singlepageapp</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script <span class="keyword">class</span>=<span class="string">&quot;pre&quot;</span>&gt;</span><br><span class="line">    <span class="comment">// The current application coordinates were pre-registered in a B2C tenant.</span></span><br><span class="line">    <span class="keyword">var</span> applicationConfig = &#123;</span><br><span class="line">        <span class="attr">clientID</span>: <span class="string">&#x27;df8f3cb5-b668-4e11-a8ca-ad4f78cb87f4&#x27;</span>,</span><br><span class="line">        <span class="attr">authority</span>: <span class="string">&quot;https://login.microsoftonline.com/tfp/luconsultingb2c.onmicrosoft.com/b2c_1_siupin&quot;</span>,</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//use scope &quot;read&quot;, as it is required in the Web API (see the webapi code in above)</span></span><br><span class="line">        <span class="attr">b2cScopes</span>: [<span class="string">&quot;https://luconsultingb2c.onmicrosoft.com/B2CEchoWebAPI/read&quot;</span>],</span><br><span class="line">        <span class="attr">webApi</span>: <span class="string">&#x27;http://localhost:5000/hello&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/login%20with%20linkedin.gif" class="" title="login with linkedin">

<p>Look at the claim properties</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/Claim%20properties.png" class="" title="Claim properties">
<p>As you can see that most of the user properties are from my Linkedin profile. Since this is the first time I signin, the <strong>newUser</strong> is true.</p>
<p>Also verify that the new user is created in AAD B2C</p>
<img src="/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/All%20users%20in%20AAD%20B2C.png" class="" title="All users in AAD B2C">

<p>EOF.</p>
<h1 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h1><ol>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-spa" title="Single-page app sign-in by using OAuth 2.0 implicit flow">https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-reference-spa</a></li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/" data-id="cm8t2lr2a001c08nd52akf5qg" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/11/05/Infrastructure-as-code-in-the-real-world/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    Infrastructure-as-Code and CI/CD in the real world, with VSTS and Azure (Part 1)
                
            </div>
        </a>
    
    
        <a href="/2017/05/17/Using-python-to-organize-pictures/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">Using python to organize pictures</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2025/03/28/Building-a-Tibber-MCP-Server-Connect-Your-AI-Agent-to-Energy-Consumption-Data/" class="title">Building a Tibber MCP Server: Connect Your AI Agent to Energy Consumption Data</a></p>
                            <p class="item-date"><time datetime="2025-03-28T13:25:48.000Z" itemprop="datePublished">2025-03-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2024/12/03/Build-a-Multi-Agent-System-to-Discover-the-Top-AI-Model-for-Rock-Paper-Scissors-Games/" class="title">Build a Multi-Agent System to Discover the Top AI Model for Rock-Paper-Scissors Games</a></p>
                            <p class="item-date"><time datetime="2024-12-03T15:21:40.000Z" itemprop="datePublished">2024-12-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/" class="title">Implementing Secret-less Access to Azure and AWS with Azure Managed Identities and AWS IAM</a></p>
                            <p class="item-date"><time datetime="2024-09-18T12:49:21.000Z" itemprop="datePublished">2024-09-18</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2024/07/04/AWS-Blog-Build-your-multilingual-personal-calendar-assistant-with-Amazon-Bedrock-and-AWS-Step-Functions/" class="title">AWS Blog - Build your multilingual personal calendar assistant with Amazon Bedrock and AWS Step Functions</a></p>
                            <p class="item-date"><time datetime="2024-07-04T08:50:24.000Z" itemprop="datePublished">2024-07-04</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2023/05/23/Manage-IoT-device-state-anywhere-using-AWS-IoT-services/" class="title">AWS Blog - Manage IoT device state anywhere using AWS IoT Device Shadow service and AWS IoT Greengrass</a></p>
                            <p class="item-date"><time datetime="2023-05-23T08:34:20.000Z" itemprop="datePublished">2023-05-23</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">March 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/ADFS/" style="font-size: 10px;">ADFS</a> <a href="/tags/AI/" style="font-size: 12.86px;">AI</a> <a href="/tags/AI-Agent/" style="font-size: 12.86px;">AI Agent</a> <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/ASP-Net-Core/" style="font-size: 10px;">ASP.Net Core</a> <a href="/tags/AWS/" style="font-size: 17.14px;">AWS</a> <a href="/tags/AWS-Control-Tower/" style="font-size: 10px;">AWS Control Tower</a> <a href="/tags/AWS-IoT-Core/" style="font-size: 10px;">AWS IoT Core</a> <a href="/tags/AWS-IoT-Greengrass/" style="font-size: 10px;">AWS IoT Greengrass</a> <a href="/tags/AWS-SSO/" style="font-size: 10px;">AWS SSO</a> <a href="/tags/AWS-Step-Functions/" style="font-size: 10px;">AWS Step Functions</a> <a href="/tags/AWS-Systems-Manager/" style="font-size: 10px;">AWS Systems Manager</a> <a href="/tags/Agent/" style="font-size: 10px;">Agent</a> <a href="/tags/Amazon-Bedrock/" style="font-size: 10px;">Amazon Bedrock</a> <a href="/tags/Amazon-Lookout-for-Vision/" style="font-size: 10px;">Amazon Lookout for Vision</a> <a href="/tags/Application-Insights/" style="font-size: 12.86px;">Application Insights</a> <a href="/tags/Artificial-Intelligence/" style="font-size: 11.43px;">Artificial Intelligence</a> <a href="/tags/Authentication/" style="font-size: 10px;">Authentication</a> <a href="/tags/Authorization/" style="font-size: 10px;">Authorization</a> <a href="/tags/Azure/" style="font-size: 18.57px;">Azure</a> <a href="/tags/Azure-AD-B2C/" style="font-size: 10px;">Azure AD B2C</a> <a href="/tags/Azure-Data-Explorer-ADX/" style="font-size: 10px;">Azure Data Explorer (ADX)</a> <a href="/tags/Azure-IoT-Edge/" style="font-size: 10px;">Azure IoT Edge</a> <a href="/tags/Azure-IoT-Hub/" style="font-size: 10px;">Azure IoT Hub</a> <a href="/tags/Azure-Template/" style="font-size: 10px;">Azure Template</a> <a href="/tags/Blockchain/" style="font-size: 10px;">Blockchain</a> <a href="/tags/Blog/" style="font-size: 12.86px;">Blog</a> <a href="/tags/Build/" style="font-size: 11.43px;">Build</a> <a href="/tags/Car/" style="font-size: 11.43px;">Car</a> <a href="/tags/Chatbot/" style="font-size: 11.43px;">Chatbot</a> <a href="/tags/Claude/" style="font-size: 10px;">Claude</a> <a href="/tags/Continuous-Deployment/" style="font-size: 10px;">Continuous Deployment</a> <a href="/tags/Continuous-Integration/" style="font-size: 10px;">Continuous Integration</a> <a href="/tags/CrewAI/" style="font-size: 10px;">CrewAI</a> <a href="/tags/DIY/" style="font-size: 10px;">DIY</a> <a href="/tags/DLT/" style="font-size: 15.71px;">DLT</a> <a href="/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/tags/Data-Analytics/" style="font-size: 12.86px;">Data Analytics</a> <a href="/tags/Data-Integrity/" style="font-size: 14.29px;">Data Integrity</a> <a href="/tags/Data-Lineage/" style="font-size: 14.29px;">Data Lineage</a> <a href="/tags/Databricks/" style="font-size: 10px;">Databricks</a> <a href="/tags/Decryption/" style="font-size: 10px;">Decryption</a> <a href="/tags/DevOps/" style="font-size: 14.29px;">DevOps</a> <a href="/tags/Device-Shadow/" style="font-size: 10px;">Device Shadow</a> <a href="/tags/Distributed-Ledger-Technology/" style="font-size: 15.71px;">Distributed Ledger Technology</a> <a href="/tags/Docker/" style="font-size: 11.43px;">Docker</a> <a href="/tags/Domain/" style="font-size: 10px;">Domain</a> <a href="/tags/EC2/" style="font-size: 10px;">EC2</a> <a href="/tags/ECS-Anywhere/" style="font-size: 10px;">ECS Anywhere</a> <a href="/tags/Encoding/" style="font-size: 10px;">Encoding</a> <a href="/tags/Entra-ID/" style="font-size: 10px;">Entra ID</a> <a href="/tags/Fiddler/" style="font-size: 10px;">Fiddler</a> <a href="/tags/Fullnode/" style="font-size: 10px;">Fullnode</a> <a href="/tags/GPS/" style="font-size: 10px;">GPS</a> <a href="/tags/Game/" style="font-size: 10px;">Game</a> <a href="/tags/GenAI/" style="font-size: 12.86px;">GenAI</a> <a href="/tags/Generative-AI/" style="font-size: 12.86px;">Generative AI</a> <a href="/tags/Git/" style="font-size: 12.86px;">Git</a> <a href="/tags/Github/" style="font-size: 11.43px;">Github</a> <a href="/tags/Google-Analytics/" style="font-size: 10px;">Google Analytics</a> <a href="/tags/Google-Tag-Manager/" style="font-size: 10px;">Google Tag Manager</a> <a href="/tags/Grafana/" style="font-size: 10px;">Grafana</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Hamster/" style="font-size: 10px;">Hamster</a> <a href="/tags/Hexo/" style="font-size: 11.43px;">Hexo</a> <a href="/tags/Home-Assistant/" style="font-size: 10px;">Home Assistant</a> <a href="/tags/IAM/" style="font-size: 11.43px;">IAM</a> <a href="/tags/IOTA/" style="font-size: 15.71px;">IOTA</a> <a href="/tags/Idp/" style="font-size: 10px;">Idp</a> <a href="/tags/Infrastructure-as-Code/" style="font-size: 10px;">Infrastructure as Code</a> <a href="/tags/IoT/" style="font-size: 20px;">IoT</a> <a href="/tags/Istio/" style="font-size: 10px;">Istio</a> <a href="/tags/Json/" style="font-size: 10px;">Json</a> <a href="/tags/Jump-start/" style="font-size: 10px;">Jump-start</a> <a href="/tags/Jupyter-Notebook/" style="font-size: 11.43px;">Jupyter Notebook</a> <a href="/tags/KUDU/" style="font-size: 10px;">KUDU</a> <a href="/tags/Kiali/" style="font-size: 10px;">Kiali</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/LLM/" style="font-size: 10px;">LLM</a> <a href="/tags/LangGraph/" style="font-size: 10px;">LangGraph</a> <a href="/tags/Linkedin/" style="font-size: 10px;">Linkedin</a> <a href="/tags/Llama/" style="font-size: 10px;">Llama</a> <a href="/tags/Load-Testing/" style="font-size: 10px;">Load Testing</a> <a href="/tags/MCP/" style="font-size: 10px;">MCP</a> <a href="/tags/Machine-Learning/" style="font-size: 11.43px;">Machine Learning</a> <a href="/tags/Managed-Identity/" style="font-size: 10px;">Managed Identity</a> <a href="/tags/Microsoft-language-understanding-intelligent-service/" style="font-size: 11.43px;">Microsoft language understanding intelligent service</a> <a href="/tags/Model-Context-Protocol/" style="font-size: 10px;">Model Context Protocol</a> <a href="/tags/Monitoring/" style="font-size: 12.86px;">Monitoring</a> <a href="/tags/Movie/" style="font-size: 10px;">Movie</a> <a href="/tags/Nano-Pi/" style="font-size: 10px;">Nano Pi</a> <a href="/tags/Native-App/" style="font-size: 10px;">Native App</a> <a href="/tags/Nodejs/" style="font-size: 10px;">Nodejs</a> <a href="/tags/OAuth/" style="font-size: 11.43px;">OAuth</a> <a href="/tags/OBD2/" style="font-size: 10px;">OBD2</a> <a href="/tags/Okta/" style="font-size: 10px;">Okta</a> <a href="/tags/OpenAI/" style="font-size: 10px;">OpenAI</a> <a href="/tags/OpenID/" style="font-size: 10px;">OpenID</a> <a href="/tags/Plugin/" style="font-size: 10px;">Plugin</a> <a href="/tags/Postman/" style="font-size: 10px;">Postman</a> <a href="/tags/PowerBI/" style="font-size: 12.86px;">PowerBI</a> <a href="/tags/Powershell/" style="font-size: 10px;">Powershell</a> <a href="/tags/Prototype/" style="font-size: 11.43px;">Prototype</a> <a href="/tags/Python/" style="font-size: 12.86px;">Python</a> <a href="/tags/Raspberry-Pi/" style="font-size: 12.86px;">Raspberry Pi</a> <a href="/tags/Release-Management/" style="font-size: 10px;">Release Management</a> <a href="/tags/Release-management/" style="font-size: 10px;">Release management</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SSM/" style="font-size: 10px;">SSM</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/SVMP/" style="font-size: 10px;">SVMP</a> <a href="/tags/Scripting/" style="font-size: 10px;">Scripting</a> <a href="/tags/Security/" style="font-size: 10px;">Security</a> <a href="/tags/Service-mesh/" style="font-size: 10px;">Service mesh</a> <a href="/tags/SharePoint-PnP/" style="font-size: 10px;">SharePoint PnP</a> <a href="/tags/Social-Sharing/" style="font-size: 10px;">Social Sharing</a> <a href="/tags/Step-Functions/" style="font-size: 10px;">Step Functions</a> <a href="/tags/Tangle/" style="font-size: 14.29px;">Tangle</a> <a href="/tags/Tibber/" style="font-size: 10px;">Tibber</a> <a href="/tags/Time-Series-Insight-TSI/" style="font-size: 10px;">Time Series Insight (TSI)</a> <a href="/tags/Troubleshooting/" style="font-size: 11.43px;">Troubleshooting</a> <a href="/tags/VPC/" style="font-size: 10px;">VPC</a> <a href="/tags/VPC-Endpoint/" style="font-size: 10px;">VPC Endpoint</a> <a href="/tags/VSTS/" style="font-size: 12.86px;">VSTS</a> <a href="/tags/Vim/" style="font-size: 10px;">Vim</a> <a href="/tags/Visualization/" style="font-size: 10px;">Visualization</a> <a href="/tags/Web-Testing/" style="font-size: 10px;">Web Testing</a> <a href="/tags/Zigbee/" style="font-size: 10px;">Zigbee</a> <a href="/tags/e-paper/" style="font-size: 10px;">e-paper</a>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2025 Feng Lu<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a target="_blank" rel="noopener" href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'https://feng.lu/2017/06/28/OAuth-in-Azure-AD-B2C-with-Nodejs/';
        
        this.page.identifier = 'OAuth-in-Azure-AD-B2C-with-Nodejs';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'linkcd' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>



    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
</body>
</html>
