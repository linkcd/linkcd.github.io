<!DOCTYPE html>
<html lang=en>
<head>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T85N4CJ');</script>
<!-- End Google Tag Manager -->

	
    <meta charset="utf-8">
    
    <title>Implementing Secret-less Access to Azure and AWS with Azure Managed Identities and AWS IAM | feng.blog();</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="1. User caseNowadays, it is common for companies to operate in multi-cloud environments, such as Azure and AWS. They often use Microsoft Entra ID (formerly Azure Active Directory) as their centralized">
<meta property="og:type" content="article">
<meta property="og:title" content="Implementing Secret-less Access to Azure and AWS with Azure Managed Identities and AWS IAM">
<meta property="og:url" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/index.html">
<meta property="og:site_name" content="feng.blog();">
<meta property="og:description" content="1. User caseNowadays, it is common for companies to operate in multi-cloud environments, such as Azure and AWS. They often use Microsoft Entra ID (formerly Azure Active Directory) as their centralized">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/problem.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/architecture.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20sami.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20uami.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/SAMI%20object%20id.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/UAMI%20object%20id.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/tenant%20id.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/create%20new%20entra%20app.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/enable%20assignment%20required.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/create%20application%20role.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/create%20app%20id%20uri.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/entra%20id%20app%20users.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/add%20idp%20to%20aws.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20role%201.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20role%202.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20role%203.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/sa%20role%20arn.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20run%20csx.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20proj.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20files.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20files.png">
<meta property="og:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/demo%20screenshot.png">
<meta property="article:published_time" content="2024-09-18T12:49:21.000Z">
<meta property="article:modified_time" content="2025-03-28T09:05:16.791Z">
<meta property="article:author" content="Feng Lu">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="Azure">
<meta property="article:tag" content="Security">
<meta property="article:tag" content="Idp">
<meta property="article:tag" content="IAM">
<meta property="article:tag" content="Managed Identity">
<meta property="article:tag" content="Entra ID">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/problem.png">
    

    
        <link rel="alternate" href="/atom.xml" title="feng.blog();" type="application/atom+xml" />
    

    
        <link rel="icon" href="/images/favicon.png" />
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">


    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T85N4CJ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">feng.blog();</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/images/avatar.jpg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/images/avatar.jpg" />
            <h2 id="name">Feng Lu</h2>
            <h3 id="title">Builder, Speaker, Architect and Technical Evangelist</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Oslo Area, Norway</span>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                39
                <span>posts</span>
            </div>
            <div class="article-info-block">
                129
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://www.linkedin.com/in/linkcd" target="_blank" title="linkedin" class=tooltip>
                            <i class="fa fa-linkedin"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="https://github.com/linkcd" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/atom.xml" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Implementing Secret-less Access to Azure and AWS with Azure Managed Identities and AWS IAM
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/">
            <time datetime="2024-09-18T12:49:21.000Z" itemprop="datePublished">2024-09-18</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/AWS/" rel="tag">AWS</a>, <a class="tag-link-link" href="/tags/Azure/" rel="tag">Azure</a>, <a class="tag-link-link" href="/tags/Entra-ID/" rel="tag">Entra ID</a>, <a class="tag-link-link" href="/tags/IAM/" rel="tag">IAM</a>, <a class="tag-link-link" href="/tags/Idp/" rel="tag">Idp</a>, <a class="tag-link-link" href="/tags/Managed-Identity/" rel="tag">Managed Identity</a>, <a class="tag-link-link" href="/tags/Security/" rel="tag">Security</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="1-User-case"><a href="#1-User-case" class="headerlink" title="1. User case"></a>1. User case</h2><p>Nowadays, it is common for companies to operate in multi-cloud environments, such as Azure and AWS. They often use Microsoft Entra ID (formerly Azure Active Directory) as their centralized identity provider (IdP), managing identities for both <strong>human users</strong> and <strong>applications</strong>. They would like to use the Entra ID identities to access resources in AWS.</p>
<p>Establishing human user identity access across Azure and AWS is straightforward. The IT department can use <a target="_blank" rel="noopener" href="https://aws.amazon.com/iam/identity-center/">AWS IAM Identity Center</a> to allow users from Microsoft Entra ID to sign-in to the AWS Management Console with Single Sign-On (SSO) via their browser. This integration simplifies authentication, offering a seamless and secure user experience across both Azure and AWS environments. For more information, you can read <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/singlesignon/latest/userguide/idp-microsoft-entra.html">this document</a>.</p>
<p>However, the browser-based SSO approach for human users does not apply to applications.</p>
<p>For applications, developers follow security best practices by using cloud-native IAM (Identity and Access Management) mechanisms to manage resource access. In AWS, this mechanism is <a target="_blank" rel="noopener" href="https://aws.amazon.com/iam/">AWS IAM</a>, while in Azure, it is typically <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview">Azure Managed Identity</a>. For example, by leveraging Azure Managed Identity, developers can build applications in Azure without the need to manage secrets or keys.</p>
<p>This approach is known as <strong>secretless access</strong> to cloud resources. </p>
<p>AWS IAM and Azure Managed Identity work well within their respective platforms, but there are cross-cloud scenarios where a workload in one cloud needs to access resources in another. For instance, an Azure Function might need to save data to both an Azure Storage account and an AWS S3 bucket for cross-cloud backup. The Azure Function uses Managed Identity to access the Azure Storage account. For accessing S3, the developer could create an IAM user and store the IAM user credentials. However, there is a better way to achieve secretless access to both Azure and AWS resources using the same Azure Managed Identity.</p>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/problem.png" class="" title="The problem of using Azure Managed Identity to access S3">

<h2 id="2-Solution"><a href="#2-Solution" class="headerlink" title="2. Solution"></a>2. Solution</h2><p>In AWS, there are multiple ways to request temporary, limited-privilege credentials by using <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/STS/latest/APIReference/welcome.html">AWS Security Token Service (AWS STS)</a>, such as <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html">AssumeRoleWithSAML</a> and <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithWebIdentity.html">AssumeRoleWithWebIdentity</a>.</p>
<p>The post will explain how to use <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithWebIdentity.html.">AssumeRoleWithWebIdentity</a> and <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-idp_oidc.html">IAM Web Identity Role</a> to extend the permissions of the same Azure Managed Identity to also access AWS resources.  </p>
<p>We will build an Azure Function with a managed identity, either User-Assigned Managed Identity (UAMI) or System-Assigned Managed Identity (SAMI), to read objects from both an Azure Storage account and an AWS S3 bucket. This same managed identity will work in both Azure and AWS, eliminating the need to manage additional secrets such as AWS IAM user credentials.</p>
<p>The source code is published at github <a target="_blank" rel="noopener" href="https://github.com/linkcd/Secretless-cross-cloud-access">https://github.com/linkcd/Secretless-cross-cloud-access</a></p>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/architecture.png" class="" title="Architecture">

<span id="more"></span>

<h2 id="3-Step-by-step-instruction"><a href="#3-Step-by-step-instruction" class="headerlink" title="3. Step by step instruction"></a>3. Step by step instruction</h2><h3 id="3-1-Create-Azure-functions-and-managed-identities"><a href="#3-1-Create-Azure-functions-and-managed-identities" class="headerlink" title="3.1 Create Azure functions and managed identities"></a>3.1 Create Azure functions and managed identities</h3><ol>
<li>Create function <strong>CrossCloudAccessFunction-SAMI</strong>: System-Assigned Managed Identity (SAMI)</li>
</ol>
<ul>
<li>In the management panel, enable SAMI</li>
</ul>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20sami.png" class="">

<ol start="2">
<li>Create function <strong>CrossCloudAccessFunction-UAMI</strong>: User-Assigned Managed Identity (UAMI)</li>
</ol>
<ul>
<li>Create a UAMI named <em>UAMI-CrossCloudAccess-Identity</em> </li>
<li>Assign the identity <em>UAMI-CrossCloudAccess-Identity</em> to Azure function <em>CrossCloudAccessFunction-UAMI</em></li>
</ul>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20uami.png" class="">

<p>Note: it is possible to have multiple UAMI or mix between UAMI&#x2F;SAMI for one Azure function. Depends on which credential (either SAMI, or one of the UAMIs) you use for calling API, you will have different permission to access different resources, depends on what credential you create in the code.</p>
<h3 id="3-2-Look-for-the-Object-IDs-of-SAMI-and-UAMI"><a href="#3-2-Look-for-the-Object-IDs-of-SAMI-and-UAMI" class="headerlink" title="3.2 Look for the Object IDs of SAMI and UAMI"></a>3.2 Look for the Object IDs of SAMI and UAMI</h3><p>We need to take note of the Object IDs of the SAMI and UAMI. These IDs will be used when assign access to an Azure application role. We also need to take note of the Entra ID tenant ID.</p>
<ol>
<li><strong>SAMI</strong> Object ID</li>
</ol>
<ul>
<li>Go to Azure Portal -&gt; Entra ID -&gt; Enterprise applications</li>
<li>Remove the filter “Application type &#x3D;&#x3D; Enterprise applications”</li>
<li>Search for the name of Azure Function with SAMI: <em>CrossCloudAccessFunction-SAMI</em></li>
<li>Take note of the Object ID. In this case “SAMI-object-id-a43c24bd12f5”</li>
</ul>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/SAMI%20object%20id.png" class="">

<ol start="2">
<li><strong>UAMI</strong> Object ID</li>
</ol>
<ul>
<li>Go to Azure Portal -&gt; Managed Identity -&gt; <em>UAMI-CrossCloudAccess-Identity</em></li>
<li>You can directly get the client ID of UAMI in its own property page. </li>
<li>In this case, it is “UAMI-object-id-0293fe81ee59”</li>
</ul>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/UAMI%20object%20id.png" class="">

<ol start="3">
<li>Get Entra ID tenant</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/entra/fundamentals/how-to-find-tenant">Find your Entra ID tenant ID</a></li>
</ul>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/tenant%20id.png" class="">


<h3 id="3-3-Create-Azure-application-and-assign-managed-identities-to-its-role"><a href="#3-3-Create-Azure-application-and-assign-managed-identities-to-its-role" class="headerlink" title="3.3 Create Azure application and assign managed identities to its role"></a>3.3 Create Azure application and assign managed identities to its role</h3><ol>
<li>Go to Azure Portal -&gt; Entra Id -&gt; Enterprise applications -&gt; New Application </li>
<li>Select “Create your own application” and name it as “AWS-Federation-App”</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/create%20new%20entra%20app.png" class="">
<ol start="3">
<li>(<strong>Important</strong>) Turn on the “User assignment required” to make sure only identities assigned to the application can get a token for the application audience. It means users and other apps or services must first be assigned this application before being able to access it.</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/enable%20assignment%20required.png" class="">
<ol start="4">
<li>Create an application role “AssumeAWSRole”</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/create%20application%20role.png" class="">
<ol start="5">
<li>Add an Application ID URI “api:&#x2F;&#x2F;AWS-Federation-App”</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/create%20app%20id%20uri.png" class="">
<ol start="6">
<li>Finally, assign the managed identities access to the application role<br>Follow the steps in the <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/how-to-assign-app-role-managed-identity?pivots=identity-mi-app-role-powershell">document</a> to assign the managed identities access to the application role</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Your tenant ID (in the Azure portal, under Azure Active Directory &gt; Overview).</span></span><br><span class="line"><span class="variable">$tenantID</span> = <span class="string">&#x27;&lt;tenant-id&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-TenantId</span> <span class="variable">$tenantId</span> <span class="literal">-Scopes</span> <span class="string">&#x27;Application.Read.All&#x27;</span>,<span class="string">&#x27;Application.ReadWrite.All&#x27;</span>,<span class="string">&#x27;AppRoleAssignment.ReadWrite.All&#x27;</span>,<span class="string">&#x27;Directory.AccessAsUser.All&#x27;</span>,<span class="string">&#x27;Directory.Read.All&#x27;</span>,<span class="string">&#x27;Directory.ReadWrite.All&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the managed identity object Id of SAMI or UAMI</span></span><br><span class="line"><span class="variable">$managedIdentityObjectId</span> = <span class="string">&quot;SAMI-object-id-a43c24bd12f5&quot;</span> <span class="comment">#SAMI</span></span><br><span class="line"><span class="comment"># $managedIdentityObjectId = &quot;UAMI-object-id-0293fe81ee59&quot; #UAMI</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the server app that exposes the app role.</span></span><br><span class="line"><span class="variable">$serverApplicationName</span> = <span class="string">&quot;AWS-Federation-App&quot;</span> <span class="comment">#Entra ID Enterprise App Name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the app role that the managed identity should be assigned to.</span></span><br><span class="line"><span class="variable">$appRoleName</span> = <span class="string">&#x27;AssumeAWSRole&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Look up the details about the server app&#x27;s service principal and app role.</span></span><br><span class="line"><span class="variable">$serverServicePrincipal</span> = (<span class="built_in">Get-MgServicePrincipal</span> <span class="literal">-Filter</span> <span class="string">&quot;DisplayName eq &#x27;<span class="variable">$serverApplicationName</span>&#x27;&quot;</span>)</span><br><span class="line"><span class="variable">$serverServicePrincipalObjectId</span> = <span class="variable">$serverServicePrincipal</span>.Id</span><br><span class="line"><span class="variable">$appRoleId</span> = (<span class="variable">$serverServicePrincipal</span>.AppRoles | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Value <span class="operator">-eq</span> <span class="variable">$appRoleName</span> &#125;).Id</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign the managed identity access to the app role.</span></span><br><span class="line"><span class="built_in">New-MgServicePrincipalAppRoleAssignment</span> <span class="literal">-ServicePrincipalId</span> <span class="variable">$serverServicePrincipalObjectId</span> <span class="literal">-PrincipalId</span> <span class="variable">$managedIdentityObjectId</span> <span class="literal">-ResourceId</span> <span class="variable">$serverServicePrincipalObjectId</span> <span class="literal">-AppRoleId</span> <span class="variable">$appRoleId</span></span><br></pre></td></tr></table></figure>
<ol start="7">
<li>Verify that the UAMI and SAMI are users of the application</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/entra%20id%20app%20users.png" class="">

<h3 id="3-4-Setup-federation-between-the-Azure-application-role-and-AWS-IAM"><a href="#3-4-Setup-federation-between-the-Azure-application-role-and-AWS-IAM" class="headerlink" title="3.4 Setup federation between the Azure application role and AWS IAM"></a>3.4 Setup federation between the Azure application role and AWS IAM</h3><ol>
<li>Go to AWS console, then head to IAM</li>
<li>Click “Identity providers” and add an “OpenID Connect” provider</li>
<li><strong>Provider URL</strong>: <a target="_blank" rel="noopener" href="https://sts.windows.net/[your-azure-tenant-id]/">https://sts.windows.net/[your-azure-tenant-id]/</a> (note: make sure you add “&#x2F;“ at the end of the URL) </li>
<li><strong>Audience</strong>: Application ID URI “api:&#x2F;&#x2F;AWS-Federation-App”</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/add%20idp%20to%20aws.png" class="">

<h3 id="3-5-Create-AWS-S3-bucket-and-related-AWS-IAM-Role-for-accessing-S3"><a href="#3-5-Create-AWS-S3-bucket-and-related-AWS-IAM-Role-for-accessing-S3" class="headerlink" title="3.5 Create AWS S3 bucket and related AWS IAM Role for accessing S3"></a>3.5 Create AWS S3 bucket and related AWS IAM Role for accessing S3</h3><ol>
<li>Create an AWS S3 bucket</li>
<li>Go to AWS IAM, create new Role for access S3</li>
<li><strong>Trusted entity</strong>: the OpenID Connect Idp that we just created</li>
<li><strong>Audience</strong>: “api:&#x2F;&#x2F;AWS-Federation-App”</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20role%201.png" class="">
<ol start="5">
<li>Assigning the s3 read-only permission (<strong>NOTE: It grants the read-only permission to ALL s3 buckets. Do NOT use it in your production workload</strong>)</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20role%202.png" class="">
<ol start="6">
<li>Name this role as “<strong>S3AccessRoleFromAzure</strong>“</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20role%203.png" class="">
<ol start="7">
<li>Take notes of ARN of these AWS IAM Roles. Azure function need it for assuming the role.</li>
</ol>
<ul>
<li>arn:aws:iam::[YOUR_AWS_ACCOUNT_NUMBER]:role&#x2F;S3AccessRoleFromAzure</li>
</ul>
  <img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/sa%20role%20arn.png" class="">

<h3 id="3-6-Create-Azure-storage-account-and-setup-permission-for-managed-identities"><a href="#3-6-Create-Azure-storage-account-and-setup-permission-for-managed-identities" class="headerlink" title="3.6 Create Azure storage account and setup permission for managed identities"></a>3.6 Create Azure storage account and setup permission for managed identities</h3><ol>
<li>Create an Azure storage account and upload some test files into a container named <em>mycontainer</em>.</li>
<li>In the storage account management panel, grant UAMI and SAMI “Storage Blob Data Contributor&#x2F;Owner” Role<br>(Note, the simple “Owner” role of storage account top level is NOT enough for read&#x2F;write blobs in container), see <a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/azure/storage/common/storage-auth-aad-app?tabs=dotnet">document</a>)</li>
</ol>
<h3 id="3-7-Update-Azure-function-source-code"><a href="#3-7-Update-Azure-function-source-code" class="headerlink" title="3.7 Update Azure function source code"></a>3.7 Update Azure function source code</h3><p>Now we got everything ready, time to work on the source code of Azure functions.</p>
<p>Both SAMI and UAMI based functions use the <a target="_blank" rel="noopener" href="https://github.com/linkcd/Secretless-cross-cloud-access/tree/main/AzureFunction">same code base</a>, as there are only a difference of getting AzureCredential between SAMI and UAMI. If you know for sure which type of managed identity you are using, you can remove the if&#x2F;else condition to optimize the code.</p>
<p>In addition to the <a target="_blank" rel="noopener" href="https://github.com/linkcd/Secretless-cross-cloud-access/blob/main/AzureFunction/run.csx">run.csx</a>, also use <a target="_blank" rel="noopener" href="https://github.com/linkcd/Secretless-cross-cloud-access/blob/main/AzureFunction/function.proj">function.proj</a> to include AWS SDK for calling AWS APIs.</p>
<p>screenshot of run.csx</p>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20run%20csx.png" class="" title="run.csx">

<p>screenshot of function.proj</p>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20function%20proj.png" class="" title="function.proj">

<h3 id="3-8-Test"><a href="#3-8-Test" class="headerlink" title="3.8 Test"></a>3.8 Test</h3><ol>
<li>Now we have files both in Azure storage account and in AWS S3</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/azure%20files.png" class="">
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/s3%20files.png" class="">

<ol start="2">
<li>Call the Azure Functions<br>Use the sample input Json for <a target="_blank" rel="noopener" href="https://github.com/linkcd/Secretless-cross-cloud-access/blob/main/AzureFunction/sample-request-UAMI.json">UAMI</a> and <a target="_blank" rel="noopener" href="https://github.com/linkcd/Secretless-cross-cloud-access/blob/main/AzureFunction/sample-request-SAMI.json">SAMI</a> when you are calling the Azure Functions. (Remember to replace the placeholder parameters with correct values.)</li>
</ol>
<p>The azure function prints the JWT in the log, it looks like</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;aud&quot;</span><span class="punctuation">:</span> <span class="string">&quot;api://AWS-Federation-App&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://sts.windows.net/&lt;azure-tenant-id&gt;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;idp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://sts.windows.net/&lt;azure-tenant-id&gt;/&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;appid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;managed-identity-client-id&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;oid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;managed-identity-object-id&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;roles&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;AssumeAWSRole&quot;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;managed-identity-object-id&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Successfully load data from both Azure and S3</li>
</ol>
<img src="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/demo%20screenshot.png" class="">

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>By following this post, you can continue using Entra ID as a single IdP, covering both AWS and Azure. This approach not only reduces management overhead but also enhances security in a multi-cloud scenario.</p>
<h2 id="Also-read"><a href="#Also-read" class="headerlink" title="Also read:"></a>Also read:</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.identitydigest.com/azuread-access-aws/">Access AWS resources using Azure AD Managed Identity</a></li>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/apn/automating-openid-connect-based-aws-iam-web-identity-roles-with-microsoft-entra-id/">Automating OpenID Connect-Based AWS IAM Web Identity Roles with Microsoft Entra ID</a></li>
</ul>
<h6 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h6><p><em>This blog is intended solely for educational purposes and reflects the personal views and opinions of the author. The content provided here is not intended to be, nor should it be construed as, official guidelines or professional advice on security matters. Readers are encouraged to seek professional guidance for specific security concerns. The author assumes no responsibility or liability for any errors or omissions in the content of this blog.</em></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/" data-id="cm8smes98001070nd9r8odceh" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2024/12/03/Build-a-Multi-Agent-System-to-Discover-the-Top-AI-Model-for-Rock-Paper-Scissors-Games/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    Build a Multi-Agent System to Discover the Top AI Model for Rock-Paper-Scissors Games
                
            </div>
        </a>
    
    
        <a href="/2024/07/04/AWS-Blog-Build-your-multilingual-personal-calendar-assistant-with-Amazon-Bedrock-and-AWS-Step-Functions/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">AWS Blog - Build your multilingual personal calendar assistant with Amazon Bedrock and AWS Step Functions</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2025/03/28/Building-a-Tibber-MCP-Server-Connect-Your-AI-Agent-to-Energy-Consumption-Data/" class="title">Building a Tibber MCP Server: Connect Your AI Agent to Energy Consumption Data</a></p>
                            <p class="item-date"><time datetime="2025-03-28T13:25:48.000Z" itemprop="datePublished">2025-03-28</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2024/12/03/Build-a-Multi-Agent-System-to-Discover-the-Top-AI-Model-for-Rock-Paper-Scissors-Games/" class="title">Build a Multi-Agent System to Discover the Top AI Model for Rock-Paper-Scissors Games</a></p>
                            <p class="item-date"><time datetime="2024-12-03T15:21:40.000Z" itemprop="datePublished">2024-12-03</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/" class="title">Implementing Secret-less Access to Azure and AWS with Azure Managed Identities and AWS IAM</a></p>
                            <p class="item-date"><time datetime="2024-09-18T12:49:21.000Z" itemprop="datePublished">2024-09-18</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2024/07/04/AWS-Blog-Build-your-multilingual-personal-calendar-assistant-with-Amazon-Bedrock-and-AWS-Step-Functions/" class="title">AWS Blog - Build your multilingual personal calendar assistant with Amazon Bedrock and AWS Step Functions</a></p>
                            <p class="item-date"><time datetime="2024-07-04T08:50:24.000Z" itemprop="datePublished">2024-07-04</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2023/05/23/Manage-IoT-device-state-anywhere-using-AWS-IoT-services/" class="title">AWS Blog - Manage IoT device state anywhere using AWS IoT Device Shadow service and AWS IoT Greengrass</a></p>
                            <p class="item-date"><time datetime="2023-05-23T08:34:20.000Z" itemprop="datePublished">2023-05-23</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">March 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/ADFS/" style="font-size: 10px;">ADFS</a> <a href="/tags/AI/" style="font-size: 11.43px;">AI</a> <a href="/tags/AI-Agent/" style="font-size: 11.43px;">AI Agent</a> <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/ASP-Net-Core/" style="font-size: 10px;">ASP.Net Core</a> <a href="/tags/AWS/" style="font-size: 17.14px;">AWS</a> <a href="/tags/AWS-Control-Tower/" style="font-size: 10px;">AWS Control Tower</a> <a href="/tags/AWS-IoT-Core/" style="font-size: 10px;">AWS IoT Core</a> <a href="/tags/AWS-IoT-Greengrass/" style="font-size: 10px;">AWS IoT Greengrass</a> <a href="/tags/AWS-SSO/" style="font-size: 10px;">AWS SSO</a> <a href="/tags/AWS-Step-Functions/" style="font-size: 10px;">AWS Step Functions</a> <a href="/tags/AWS-Systems-Manager/" style="font-size: 10px;">AWS Systems Manager</a> <a href="/tags/Agent/" style="font-size: 10px;">Agent</a> <a href="/tags/Amazon-Bedrock/" style="font-size: 10px;">Amazon Bedrock,</a> <a href="/tags/Amazon-Lookout-for-Vision/" style="font-size: 10px;">Amazon Lookout for Vision</a> <a href="/tags/Application-Insights/" style="font-size: 12.86px;">Application Insights</a> <a href="/tags/Artificial-Intelligence/" style="font-size: 11.43px;">Artificial Intelligence</a> <a href="/tags/Authentication/" style="font-size: 10px;">Authentication</a> <a href="/tags/Authorization/" style="font-size: 10px;">Authorization</a> <a href="/tags/Azure/" style="font-size: 18.57px;">Azure</a> <a href="/tags/Azure-AD-B2C/" style="font-size: 10px;">Azure AD B2C</a> <a href="/tags/Azure-Data-Explorer-ADX/" style="font-size: 10px;">Azure Data Explorer (ADX)</a> <a href="/tags/Azure-IoT-Edge/" style="font-size: 10px;">Azure IoT Edge</a> <a href="/tags/Azure-IoT-Hub/" style="font-size: 10px;">Azure IoT Hub</a> <a href="/tags/Azure-Template/" style="font-size: 10px;">Azure Template</a> <a href="/tags/Blockchain/" style="font-size: 10px;">Blockchain</a> <a href="/tags/Blog/" style="font-size: 12.86px;">Blog</a> <a href="/tags/Build/" style="font-size: 11.43px;">Build</a> <a href="/tags/Car/" style="font-size: 11.43px;">Car</a> <a href="/tags/Chatbot/" style="font-size: 11.43px;">Chatbot</a> <a href="/tags/Claude/" style="font-size: 10px;">Claude</a> <a href="/tags/Continuous-Deployment/" style="font-size: 10px;">Continuous Deployment</a> <a href="/tags/Continuous-Integration/" style="font-size: 10px;">Continuous Integration</a> <a href="/tags/CrewAI/" style="font-size: 10px;">CrewAI</a> <a href="/tags/DIY/" style="font-size: 10px;">DIY</a> <a href="/tags/DLT/" style="font-size: 15.71px;">DLT</a> <a href="/tags/DNS/" style="font-size: 10px;">DNS</a> <a href="/tags/Data-Analytics/" style="font-size: 12.86px;">Data Analytics</a> <a href="/tags/Data-Integrity/" style="font-size: 14.29px;">Data Integrity</a> <a href="/tags/Data-Lineage/" style="font-size: 14.29px;">Data Lineage</a> <a href="/tags/Databricks/" style="font-size: 10px;">Databricks</a> <a href="/tags/Decryption/" style="font-size: 10px;">Decryption</a> <a href="/tags/DevOps/" style="font-size: 14.29px;">DevOps</a> <a href="/tags/Device-Shadow/" style="font-size: 10px;">Device Shadow</a> <a href="/tags/Distributed-Ledger-Technology/" style="font-size: 15.71px;">Distributed Ledger Technology</a> <a href="/tags/Docker/" style="font-size: 11.43px;">Docker</a> <a href="/tags/Domain/" style="font-size: 10px;">Domain</a> <a href="/tags/EC2/" style="font-size: 10px;">EC2</a> <a href="/tags/ECS-Anywhere/" style="font-size: 10px;">ECS Anywhere</a> <a href="/tags/Encoding/" style="font-size: 10px;">Encoding</a> <a href="/tags/Entra-ID/" style="font-size: 10px;">Entra ID</a> <a href="/tags/Fiddler/" style="font-size: 10px;">Fiddler</a> <a href="/tags/Fullnode/" style="font-size: 10px;">Fullnode</a> <a href="/tags/GPS/" style="font-size: 10px;">GPS</a> <a href="/tags/Game/" style="font-size: 10px;">Game</a> <a href="/tags/GenAI/" style="font-size: 12.86px;">GenAI</a> <a href="/tags/Generative-AI/" style="font-size: 12.86px;">Generative AI</a> <a href="/tags/Git/" style="font-size: 12.86px;">Git</a> <a href="/tags/Github/" style="font-size: 11.43px;">Github</a> <a href="/tags/Google-Analytics/" style="font-size: 10px;">Google Analytics</a> <a href="/tags/Google-Tag-Manager/" style="font-size: 10px;">Google Tag Manager</a> <a href="/tags/Grafana/" style="font-size: 10px;">Grafana</a> <a href="/tags/HTTPS/" style="font-size: 10px;">HTTPS</a> <a href="/tags/Hamster/" style="font-size: 10px;">Hamster</a> <a href="/tags/Hexo/" style="font-size: 11.43px;">Hexo</a> <a href="/tags/Home-Assistant/" style="font-size: 10px;">Home Assistant</a> <a href="/tags/IAM/" style="font-size: 11.43px;">IAM</a> <a href="/tags/IOTA/" style="font-size: 15.71px;">IOTA</a> <a href="/tags/Idp/" style="font-size: 10px;">Idp</a> <a href="/tags/Infrastructure-as-Code/" style="font-size: 10px;">Infrastructure as Code</a> <a href="/tags/IoT/" style="font-size: 20px;">IoT</a> <a href="/tags/Istio/" style="font-size: 10px;">Istio</a> <a href="/tags/Json/" style="font-size: 10px;">Json</a> <a href="/tags/Jump-start/" style="font-size: 10px;">Jump-start</a> <a href="/tags/Jupyter-Notebook/" style="font-size: 11.43px;">Jupyter Notebook</a> <a href="/tags/KUDU/" style="font-size: 10px;">KUDU</a> <a href="/tags/Kiali/" style="font-size: 10px;">Kiali</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/LLM/" style="font-size: 10px;">LLM</a> <a href="/tags/LangGraph/" style="font-size: 10px;">LangGraph</a> <a href="/tags/Linkedin/" style="font-size: 10px;">Linkedin</a> <a href="/tags/Llama/" style="font-size: 10px;">Llama</a> <a href="/tags/Load-Testing/" style="font-size: 10px;">Load Testing</a> <a href="/tags/MCP/" style="font-size: 10px;">MCP</a> <a href="/tags/Machine-Learning/" style="font-size: 11.43px;">Machine Learning</a> <a href="/tags/Managed-Identity/" style="font-size: 10px;">Managed Identity</a> <a href="/tags/Microsoft-language-understanding-intelligent-service/" style="font-size: 11.43px;">Microsoft language understanding intelligent service</a> <a href="/tags/Model-Context-Protocol/" style="font-size: 10px;">Model Context Protocol</a> <a href="/tags/Monitoring/" style="font-size: 12.86px;">Monitoring</a> <a href="/tags/Movie/" style="font-size: 10px;">Movie</a> <a href="/tags/Nano-Pi/" style="font-size: 10px;">Nano Pi</a> <a href="/tags/Native-App/" style="font-size: 10px;">Native App</a> <a href="/tags/Nodejs/" style="font-size: 10px;">Nodejs</a> <a href="/tags/OAuth/" style="font-size: 11.43px;">OAuth</a> <a href="/tags/OBD2/" style="font-size: 10px;">OBD2</a> <a href="/tags/Okta/" style="font-size: 10px;">Okta</a> <a href="/tags/OpenAI/" style="font-size: 10px;">OpenAI</a> <a href="/tags/OpenID/" style="font-size: 10px;">OpenID</a> <a href="/tags/Plugin/" style="font-size: 10px;">Plugin</a> <a href="/tags/Postman/" style="font-size: 10px;">Postman</a> <a href="/tags/PowerBI/" style="font-size: 12.86px;">PowerBI</a> <a href="/tags/Powershell/" style="font-size: 10px;">Powershell</a> <a href="/tags/Prototype/" style="font-size: 11.43px;">Prototype</a> <a href="/tags/Python/" style="font-size: 12.86px;">Python</a> <a href="/tags/Raspberry-Pi/" style="font-size: 12.86px;">Raspberry Pi</a> <a href="/tags/Release-Management/" style="font-size: 10px;">Release Management</a> <a href="/tags/Release-management/" style="font-size: 10px;">Release management</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SSM/" style="font-size: 10px;">SSM</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/SVMP/" style="font-size: 10px;">SVMP</a> <a href="/tags/Scripting/" style="font-size: 10px;">Scripting</a> <a href="/tags/Security/" style="font-size: 10px;">Security</a> <a href="/tags/Service-mesh/" style="font-size: 10px;">Service mesh</a> <a href="/tags/SharePoint-PnP/" style="font-size: 10px;">SharePoint PnP</a> <a href="/tags/Social-Sharing/" style="font-size: 10px;">Social Sharing</a> <a href="/tags/Step-Functions/" style="font-size: 10px;">Step Functions</a> <a href="/tags/Tangle/" style="font-size: 14.29px;">Tangle</a> <a href="/tags/Tibber/" style="font-size: 10px;">Tibber</a> <a href="/tags/Time-Series-Insight-TSI/" style="font-size: 10px;">Time Series Insight (TSI)</a> <a href="/tags/Troubleshooting/" style="font-size: 11.43px;">Troubleshooting</a> <a href="/tags/VPC/" style="font-size: 10px;">VPC</a> <a href="/tags/VPC-Endpoint/" style="font-size: 10px;">VPC Endpoint</a> <a href="/tags/VSTS/" style="font-size: 12.86px;">VSTS</a> <a href="/tags/Vim/" style="font-size: 10px;">Vim</a> <a href="/tags/Visualization/" style="font-size: 10px;">Visualization</a> <a href="/tags/Web-Testing/" style="font-size: 10px;">Web Testing</a> <a href="/tags/Zigbee/" style="font-size: 10px;">Zigbee</a> <a href="/tags/e-paper/" style="font-size: 10px;">e-paper</a>
        </div>
    </div>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2025 Feng Lu<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a target="_blank" rel="noopener" href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'https://feng.lu/2024/09/18/How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM/';
        
        this.page.identifier = 'How-to-secretless-access-Azure-and-AWS-resources-with-Azure-managed-identity-and-AWS-IAM';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'linkcd' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>



    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
</body>
</html>
